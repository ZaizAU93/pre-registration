<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Редактировать тест</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .answer-list {
            margin-top: 10px;
        }
        .answer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Редактировать тест: <span th:text="${test.get().title}"></span></h1>

    <form th:action="@{/test/{id}/addQuestion(id=${test.get().id})}" method="post" id="questionForm">
        <div class="form-group">
            <label for="questionText">Текст вопроса</label>
            <input type="text" id="questionText" name="questionText" class="form-control" required>
        </div>

        <!-- Формы для добавления неправильных ответов -->
        <div class="form-group">
            <label for="answerContent">Неправильный ответ</label>
            <input type="text" id="answerContent" name="answerContent" class="form-control" required>
            <button type="button" class="btn btn-secondary mt-2" onclick="addAnswer()">Добавить неправильный ответ</button>
            <div class="answer-list" id="wrongAnswersList"></div>
        </div>

        <!-- Формы для добавления правильных ответов -->
        <div class="form-group">
            <label for="correctAnswerContent">Правильный ответ</label>
            <input type="text" id="correctAnswerContent" name="correctAnswerContent" class="form-control" required>
            <button type="button" class="btn btn-secondary mt-2" onclick="addCorrectAnswer()">Добавить правильный ответ</button>
            <div class="answer-list" id="correctAnswersList"></div>
        </div>

        <h2 class="mt-5">Формирование вопроса</h2>
        <table class="table">
            <thead>
            <tr>
                <th>ID</th>
                <th>Текст вопроса</th>
                <th>Неправильные ответы</th>
                <th>Правильные ответы</th>
                <th>Действия</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="question : ${questions}">
                <td th:text="${question.id}"></td>
                <td th:text="${question.questionText}"></td>
                <td>
                    <ul>
                        <li th:each="answer : ${question.answers}" th:text="${answer.content}"></li>
                    </ul>
                </td>
                <td>
                    <ul>
                        <li th:each="correctAnswer : ${question.correctAnswer}" th:text="${correctAnswer.content}"></li>
                    </ul>
                </td>
                <td>
                    <a th:href="@{/question/edit/{id}(id=${question.id})}" class="btn btn-warning">Редактировать</a>
                    <a th:href="@{/question/delete/{id}(id=${question.id})}" class="btn btn-danger">Удалить</a>
                </td>
            </tr>
            </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Сформировать вопрос</button>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const wrongAnswers = [];
    const correctAnswers = [];

    function addAnswer() {
        const answerContent = document.getElementById('answerContent').value;
        if (answerContent) {
            wrongAnswers.push(answerContent);
            updateAnswerList('wrongAnswersList', wrongAnswers);
            document.getElementById('answerContent').value = '';
        }
    }

    function addCorrectAnswer() {
        const correctAnswerContent = document.getElementById('correctAnswerContent').value;
        if (correctAnswerContent) {
            correctAnswers.push(correctAnswerContent);
            updateAnswerList('correctAnswersList', correctAnswers);
            document.getElementById('correctAnswerContent').value = '';
        }
    }

    function updateAnswerList(listId, answers) {
        const listElement = document.getElementById(listId);
        listElement.innerHTML = '';
        answers.forEach((answer, index) => {
            const item = document.createElement('div');
            item.className = 'answer-item';
            item.innerHTML = `<span>${answer}</span>
                             <button class="btn btn-danger btn-sm" onclick="removeAnswer(${index}, '${listId}')">Удалить</button>`;
            listElement.appendChild(item);
        });
    }

    function removeAnswer(index, listId) {
        if (listId === 'wrongAnswersList') {
            wrongAnswers.splice(index, 1);
            updateAnswerList(listId, wrongAnswers);
        } else if (listId === 'correctAnswersList') {
            correctAnswers.splice(index, 1);
            updateAnswerList(listId, correctAnswers);
        }
    }

    // При отправке формы, добавляем ответы в скрытые поля формы
    $('#questionForm').on('submit', function() {
        const wrongAnswersInput = $('<input>').attr({
            type: 'hidden',
            name: 'wrongAnswers',
            value: JSON.stringify(wrongAnswers)
        });
        const correctAnswersInput = $('<input>').attr({
            type: 'hidden',
            name: 'correctAnswers',
            value: JSON.stringify(correctAnswers)
        });
        $(this).append(wrongAnswersInput, correctAnswersInput);
    });
</script>

</body>
</html>
